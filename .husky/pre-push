#!/bin/sh

# Husky pre-push hook - Unit tests, integration tests, benchmarks, and E2E tests

# Set env var to indicate running in git hooks (affects headless mode, dev tools, etc.)
export GIT_HOOKS=1

echo "📤 Pre-push validation..."

# Get the remote we're pushing to (usually origin)
REMOTE="${1:-origin}"
URL="$2"

# Check for benchmark regressions first (fast feedback)
echo "📊 Checking for performance regressions..."
pnpm test:benchmark || {
  echo "❌ Benchmark tests failed!"
  echo "💡 Performance contracts must pass before pushing"
  exit 1
}

# Run integration tests (they will handle their own dev environment setup)
echo "🎭 Running integration tests..."
pnpm test:integration || {
  echo "❌ Integration tests failed!"
  echo "💡 Fix integration tests before pushing"
  exit 1
}

echo ""
echo "✅ Pre-push checks complete - ready to push!"