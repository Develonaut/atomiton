#!/bin/sh

# Husky pre-commit hook - Run formatting, linting, and smoke tests

echo "ğŸ” Running pre-commit checks on staged files..."

# TODO: Re-enable package validation once requirements are relaxed
# Currently the validator requires many doc files that don't exist yet
# echo "ğŸ“¦ Validating package consistency..."
# node scripts/validate-packages.js
# if [ $? -ne 0 ]; then
#   echo "âŒ Package validation failed! Fix consistency issues before committing."
#   echo "ğŸ’¡ See Package Creation Guide: docs/development/PACKAGE_CREATION_GUIDE.md"
#   exit 1
# fi

# Run lint-staged to format and lint only staged files
npx lint-staged

if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged checks failed! Fix issues before committing."
  exit 1
fi

# TODO: Re-enable smoke tests once test infrastructure is fixed
# Currently some packages have failing smoke tests that need to be addressed
# echo "ğŸ”¥ Running smoke tests before commit..."
# pnpm turbo test:smoke
# if [ $? -ne 0 ]; then
#   echo "âŒ Smoke tests failed! Fix critical issues before committing."
#   echo "ğŸ’¡ Tip: Run 'pnpm test:smoke' in the failing package to debug."
#   exit 1
# fi

echo "âœ… All pre-commit checks passed!"