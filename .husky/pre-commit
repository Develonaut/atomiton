#!/bin/sh

# Husky pre-commit hook - Run formatting, linting, and smoke tests

echo "🔍 Running pre-commit checks on staged files..."

# TODO: Re-enable package validation once requirements are relaxed
# Currently the validator requires many doc files that don't exist yet
# echo "📦 Validating package consistency..."
# node scripts/validate-packages.js
# if [ $? -ne 0 ]; then
#   echo "❌ Package validation failed! Fix consistency issues before committing."
#   echo "💡 See Package Creation Guide: docs/development/PACKAGE_CREATION_GUIDE.md"
#   exit 1
# fi

# Run lint-staged to format and lint only staged files
npx lint-staged

if [ $? -ne 0 ]; then
  echo "❌ Lint-staged checks failed! Fix issues before committing."
  exit 1
fi

# TODO: Re-enable smoke tests once test infrastructure is fixed
# Currently some packages have failing smoke tests that need to be addressed
# echo "🔥 Running smoke tests before commit..."
# pnpm turbo test:smoke
# if [ $? -ne 0 ]; then
#   echo "❌ Smoke tests failed! Fix critical issues before committing."
#   echo "💡 Tip: Run 'pnpm test:smoke' in the failing package to debug."
#   exit 1
# fi

echo "✅ All pre-commit checks passed!"