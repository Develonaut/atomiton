# Lefthook configuration for Atomiton monorepo
# https://github.com/evilmartians/lefthook

# Set environment variable to indicate running in git hooks (affects headless mode, dev tools, etc.)
env:
  LEFTHOOK: "1"

# Fast pre-commit hooks for staged files only
pre-commit:
  parallel: true
  commands:
    # Format and fix linting issues on staged files
    format-and-lint:
      glob: "*.{ts,tsx,js,jsx,md,json,yml,yaml}"
      run: |
        echo "ğŸ”§ Formatting and fixing lint issues for staged files..."
        pnpm run fix
      stage_fixed: true

    # Type check affected packages (uses turbo's smart filtering)
    type-check:
      run: |
        echo "ğŸ” Type checking affected packages..."
        pnpm typecheck

# More comprehensive pre-push hooks - full test suite must pass
pre-push:
  parallel: false # Sequential execution for clearer output and system stability
  commands:
    # Full lint check (ensures nothing was missed)
    lint-check:
      run: |
        echo "ğŸ” Running full lint check..."
        pnpm lint

    # Full type check across all packages
    full-type-check:
      run: |
        echo "ğŸ” Running full type check..."
        pnpm typecheck

    # Unit tests for all packages
    unit-tests:
      run: |
        echo "ğŸ§ª Running unit tests for all packages..."
        pnpm test

    # Integration tests (more comprehensive)
    integration-tests:
      run: |
        echo "ğŸ­ Running integration tests..."
        pnpm test:integration

    # E2E tests (headless by default in CI/hooks)
    e2e-tests:
      run: |
        echo "ğŸŒ Running end-to-end tests (headless)..."
        pnpm test:e2e

    # Build verification (ensure everything builds)
    build-check:
      run: |
        echo "ğŸ—ï¸ Verifying build integrity..."
        pnpm build

# Skip options for cleaner output
skip_output:
  - meta
  - summary
