# Lefthook configuration for Atomiton monorepo
# https://github.com/evilmartians/lefthook

# Set environment variable to indicate running in git hooks (affects headless mode, dev tools, etc.)
env:
  LEFTHOOK: "1"

pre-commit:
  parallel: false
  commands:
    package-validation:
      run: |
        echo "ğŸ“¦ Validating package consistency..."
        pnpm exec tsx scripts/validate-packages.ts
    lint-staged:
      run: |
        echo "ğŸ“ Checking code style..."
        npx lint-staged
    unit-tests:
      run: |
        echo "ğŸ§ª Running unit tests for changed packages..."
        pnpm turbo run test --filter=[HEAD^] --ui stream --output-logs=new-only --log-order=grouped

pre-push:
  parallel: true
  commands:
    benchmark-tests:
      run: |
        echo "ğŸ“Š Checking performance regressions in changed packages..."
        pnpm turbo run test:benchmark --filter=[HEAD^] --output-logs=errors-only || {
          echo "âŒ Benchmark tests failed!"
          echo "ğŸ’¡ Performance contracts must pass before pushing"
          exit 1
        }
    integration-tests:
      run: |
        echo "ğŸ­ Running integration tests for apps and changed packages..."
        pnpm turbo run test:integration --filter=@atomiton/client --filter=@atomiton/desktop --filter=[HEAD^] --output-logs=errors-only || {
          echo "âŒ Integration tests failed!"
          echo "ğŸ’¡ Fix integration tests before pushing"
          exit 1
        }