id: "550e8400-e29b-41d4-a716-446655440003"
name: "Image Processing Workflow"
description:
  "Batch process images with parallel operations for optimal performance"
category: "media"
type: "group"
version: "1.0.0"

metadata:
  created: "2025-01-15T00:00:00Z"
  modified: "2025-01-15T00:00:00Z"
  author: "Atomiton Team"
  authorId: "atomiton-team"
  source: "system"
  type: "image-processing-workflow"
  icon: "image"
  tags:
    - "image"
    - "processing"
    - "media"
  keywords:
    - "image"
    - "photo"
    - "resize"
    - "watermark"
    - "batch"
    - "processing"
    - "media"
    - "parallel"
    - "jpg"
    - "png"
    - "gif"
  runtime:
    language: "typescript"
  experimental: false
  deprecated: false
  documentationUrl: "https://docs.atomiton.com/nodes/image-processor"

nodes:
  - id: "image-source"
    type: "file-system"
    name: "List Images"
    category: "io"
    version: "1.0.0"

    inputPorts:
      - id: "trigger"
        name: "Trigger"
        type: "trigger"
        dataType: "any"
        required: false

    outputPorts:
      - id: "output"
        name: "Output"
        type: "output"
        dataType: "any"
      - id: "error"
        name: "Error"
        type: "error"
        dataType: "object"

    parameters:
      operation: "list"
      filePath: "/images/input"
      pattern: "*.{jpg,png,gif}"
      recursive: false
      includeStats: true

    position:
      x: 50
      y: 150

  - id: "image-loop"
    type: "loop"
    name: "Process Each Image"
    category: "logic"
    version: "1.0.0"

    inputPorts:
      - id: "input"
        name: "Input"
        type: "input"
        dataType: "array"
        required: true

    outputPorts:
      - id: "item"
        name: "Item"
        type: "output"
        dataType: "any"
      - id: "index"
        name: "Index"
        type: "output"
        dataType: "number"
      - id: "complete"
        name: "Complete"
        type: "output"
        dataType: "array"

    parameters:
      iterateOver: "files"
      maxIterations: 1000
      breakOnError: false

    position:
      x: 250
      y: 150

  - id: "parallel-processor"
    type: "parallel"
    name: "Parallel Processing"
    category: "logic"
    version: "1.0.0"

    inputPorts:
      - id: "input"
        name: "Input"
        type: "input"
        dataType: "any"
        required: true

    outputPorts:
      - id: "output"
        name: "Output"
        type: "output"
        dataType: "array"

    parameters:
      concurrency: 4
      preserveOrder: true
      timeout: 30000

    position:
      x: 450
      y: 150

  - id: "image-resize"
    type: "image"
    name: "Resize Image"
    category: "media"
    version: "1.0.0"

    inputPorts:
      - id: "input"
        name: "Input"
        type: "input"
        dataType: "buffer"
        required: true

    outputPorts:
      - id: "output"
        name: "Output"
        type: "output"
        dataType: "buffer"
      - id: "metadata"
        name: "Metadata"
        type: "output"
        dataType: "object"

    parameters:
      operation: "resize"
      width: 800
      height: 600
      maintainAspectRatio: true
      quality: 85
      format: "jpeg"

    position:
      x: 650
      y: 100

  - id: "image-watermark"
    type: "image"
    name: "Add Watermark"
    category: "media"
    version: "1.0.0"

    inputPorts:
      - id: "input"
        name: "Input"
        type: "input"
        dataType: "buffer"
        required: true

    outputPorts:
      - id: "output"
        name: "Output"
        type: "output"
        dataType: "buffer"
      - id: "metadata"
        name: "Metadata"
        type: "output"
        dataType: "object"

    parameters:
      operation: "watermark"
      watermarkPath: "/assets/watermark.png"
      position: "bottom-right"
      opacity: 0.7
      scale: 0.25
      margin: 10

    position:
      x: 650
      y: 200

  - id: "save-processed"
    type: "file-system"
    name: "Save Processed Image"
    category: "io"
    version: "1.0.0"

    inputPorts:
      - id: "input"
        name: "Input"
        type: "input"
        dataType: "any"
        required: true

    outputPorts:
      - id: "output"
        name: "Output"
        type: "output"
        dataType: "any"
      - id: "error"
        name: "Error"
        type: "error"
        dataType: "object"

    parameters:
      operation: "write"
      filePath: "/images/output"
      createDirectory: true
      overwrite: true

    position:
      x: 900
      y: 150

edges:
  - id: "source-to-loop"
    source: "image-source"
    target: "image-loop"
    sourceHandle: "output"
    targetHandle: "input"

  - id: "loop-to-parallel"
    source: "image-loop"
    target: "parallel-processor"
    sourceHandle: "item"
    targetHandle: "input"

  - id: "parallel-to-resize"
    source: "parallel-processor"
    target: "image-resize"
    sourceHandle: "output"
    targetHandle: "input"

  - id: "resize-to-watermark"
    source: "image-resize"
    target: "image-watermark"
    sourceHandle: "output"
    targetHandle: "input"

  - id: "watermark-to-save"
    source: "image-watermark"
    target: "save-processed"
    sourceHandle: "output"
    targetHandle: "input"

variables:
  inputFolder:
    type: "string"
    defaultValue: "/images/input"
    description: "Path to input images folder"
  outputFolder:
    type: "string"
    defaultValue: "/images/output"
    description: "Path to output images folder"
  concurrency:
    type: "number"
    defaultValue: 4
    description: "Number of parallel processing threads"

settings:
  runtime:
    timeout: 60000
    parallel: true
  ui:
    color: "#9C27B0"
